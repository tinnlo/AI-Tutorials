<!DOCTYPE html>
<!-- saved from url=(0106)https://microsoftlearning.github.io/mslearn-ai-services/Instructions/Exercises/03-monitor-ai-services.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>
            mslearn-ai-services
        </title>
        
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="./lab03_files/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <link rel="stylesheet" href="./lab03_files/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
        <link rel="stylesheet" href="./lab03_files/vs.min.css">
        <script src="./lab03_files/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <link rel="stylesheet" href="./lab03_files/style.css">
    </head>
    <body data-spy="scroll" data-target="#linksMenu" style="overscroll-behavior-x: auto;">
    <nav class="navbar navbar-expand-lg navbar-dark bg-gray">
        <div class="container d-flex justify-content-between">
            <a class="my-1 title text-white" href="https://docs.microsoft.com/training/">
                <img src="./lab03_files/microsoft-gray.png" alt="Microsoft logo" style="width:100px;height:21px;">
            </a>
            <span class="my-1 title text-black">Microsoft Learn</span>
            <span class="ml-2"><a href="https://microsoftlearning.github.io/mslearn-ai-services">≡</a></span>
        </div>
        <!--
        <div class="container d-flex justify-content-between">
            <a class="my-1 title text-azure text-uppercase" href="https://microsoftlearning.github.io/mslearn-ai-services">
                mslearn-ai-services
            </a>
            <a href="https://github.com/MicrosoftLearning/mslearn-ai-services" target="_blank" class="btn btn-sm btn-outline-secondary text-light">
                <i class="fa fa-github" aria-hidden="true"></i>
                <span class="ml-2">GitHub</span>
            </a>
        </div>
        -->
    </nav>
    <hr color-"gray"="">
    <div class="container">
        <main class="row extra-padding">
            <aside class="col-sm-2">       
                <nav id="linksMenu" class="toc sticky-top">
                    <ul class="nav navbar-nav flex-column">
                    <li class="nav-item"><a class="nav-link" href="https://microsoftlearning.github.io/mslearn-ai-services/Instructions/Exercises/03-monitor-ai-services.html#clone-the-repository-in-visual-studio-code">Clone the repository in Visual Studio Code</a></li><li class="nav-item"><a class="nav-link" href="https://microsoftlearning.github.io/mslearn-ai-services/Instructions/Exercises/03-monitor-ai-services.html#provision-an-azure-ai-services-resource">Provision an Azure AI Services resource</a></li><li class="nav-item"><a class="nav-link" href="https://microsoftlearning.github.io/mslearn-ai-services/Instructions/Exercises/03-monitor-ai-services.html#configure-an-alert">Configure an alert</a></li><li class="nav-item"><a class="nav-link" href="https://microsoftlearning.github.io/mslearn-ai-services/Instructions/Exercises/03-monitor-ai-services.html#visualize-a-metric">Visualize a metric</a></li><li class="nav-item"><a class="nav-link" href="https://microsoftlearning.github.io/mslearn-ai-services/Instructions/Exercises/03-monitor-ai-services.html#clean-up-resources">Clean up resources</a></li><li class="nav-item"><a class="nav-link" href="https://microsoftlearning.github.io/mslearn-ai-services/Instructions/Exercises/03-monitor-ai-services.html#more-information">More information</a></li></ul>
                </nav>         
            </aside>
            <hr class="">
            <article class="col-sm-10 mb-5">
                <h1 id="monitor-azure-ai-services">Monitor Azure AI Services</h1>

<p>Azure AI Services can be a critical part of an overall application infrastructure. It’s important to be able to monitor activity and get alerted to issues that may need attention.</p>

<h2 id="clone-the-repository-in-visual-studio-code">Clone the repository in Visual Studio Code</h2>

<p>You’ll develop your code using Visual Studio Code. The code files for your app have been provided in a GitHub repo.</p>

<blockquote>
  <p><strong>Tip</strong>: If you have already cloned the <strong>mslearn-ai-services</strong> repo, open it in Visual Studio code. Otherwise, follow these steps to clone it to your development environment.</p>
</blockquote>

<ol>
  <li>Start Visual Studio Code.</li>
  <li>Open the palette (SHIFT+CTRL+P) and run a <strong>Git: Clone</strong> command to clone the <code>https://github.com/MicrosoftLearning/mslearn-ai-services</code> repository to a local folder (it doesn’t matter which folder).</li>
  <li>When the repository has been cloned, open the folder in Visual Studio Code.</li>
  <li>
    <p>Wait while additional files are installed to support the C# code projects in the repo, if necessary</p>

    <blockquote>
      <p><strong>Note</strong>: If you are prompted to add required assets to build and debug, select <strong>Not Now</strong>.</p>
    </blockquote>
  </li>
  <li>Expand the <code>Labfiles/03-monitor-ai-services</code> folder.</li>
</ol>

<h2 id="provision-an-azure-ai-services-resource">Provision an Azure AI Services resource</h2>

<p>If you don’t already have one in your subscription, you’ll need to provision an <strong>Azure AI Services</strong> resource.</p>

<ol>
  <li>Open the Azure portal at <code>https://portal.azure.com</code>, and sign in using the Microsoft account associated with your Azure subscription.</li>
  <li>In the top search bar, search for <em>Azure AI services</em>, select <strong>Azure AI Services</strong>, and create an Azure AI services multi-service account resource with the following settings:
    <ul>
      <li><strong>Subscription</strong>: <em>Your Azure subscription</em></li>
      <li><strong>Resource group</strong>: <em>Choose or create a resource group (if you are using a restricted subscription, you may not have permission to create a new resource group - use the one provided)</em></li>
      <li><strong>Region</strong>: <em>Choose any available region</em></li>
      <li><strong>Name</strong>: <em>Enter a unique name</em></li>
      <li><strong>Pricing tier</strong>: Standard S0</li>
    </ul>
  </li>
  <li>Select any required checkboxes and create the resource.</li>
  <li>Wait for deployment to complete, and then view the deployment details.</li>
  <li>When the resource has been deployed, go to it and view its <strong>Keys and Endpoint</strong> page. Make a note of the endpoint URI - you will need it later.</li>
</ol>

<h2 id="configure-an-alert">Configure an alert</h2>

<p>Let’s start monitoring by defining an alert rule so you can detect activity in your Azure AI services resource.</p>

<ol>
  <li>In the Azure portal, go to your Azure AI services resource and view its <strong>Alerts</strong> page (in the <strong>Monitoring</strong> section).</li>
  <li>Select <strong>+ Create</strong> dropdown, and select <strong>Alert rule</strong></li>
  <li>In the <strong>Create an alert rule</strong> page, under <strong>Scope</strong>, verify that the your Azure AI services resource is listed. (Close <strong>Select a signal</strong> pane if open)</li>
  <li>Select <strong>Condition</strong> tab, and select on the <strong>See all signals</strong> link to show the <strong>Select a signal</strong> pane that appears on the right, where you can select a signal type to monitor.</li>
  <li>In the <strong>Signal type</strong> list, scroll down to the <strong>Activity Log</strong> section, and then select <strong>List Keys (Cognitive Services API Account)</strong>. Then select <strong>Apply</strong>.</li>
  <li>Review the activity over the past 6 hours.</li>
  <li>Select the <strong>Actions</strong> tab. Note that you can specify an <em>action group</em>. This enables you to configure automated actions when an alert is fired - for example, sending an email notification. We won’t do that in this exercise; but it can be useful to do this in a production environment.</li>
  <li>In the <strong>Details</strong> tab, set the <strong>Alert rule name</strong> to <strong>Key List Alert</strong>.</li>
  <li>Select <strong>Review + create</strong>.</li>
  <li>Review the configuration for the alert. Select <strong>Create</strong> and wait for the alert rule to be created.</li>
  <li>
    <p>Now you can use the following command to get the list of Azure AI services keys, replacing <em>&lt;resourceName&gt;</em> with the name of your Azure AI services resource, and <em>&lt;resourceGroup&gt;</em> with the name of the resource group in which you created it.</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock0" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock0" class="mt-0"><code class="hljs xml">az cognitiveservices account keys list --name <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resourceName</span></span></span><span class="hljs-tag">&gt;</span></span> --resource-group <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resourceGroup</span></span></span><span class="hljs-tag">&gt;</span></span>
</code></pre>

    <p>The command returns a list of the keys for your Azure AI services resource.</p>

    <blockquote>
      <p><strong>Note</strong> If you haven’t logged into Azure CLI, you may need to run <code>az login</code> before the list keys command will work.</p>
    </blockquote>
  </li>
  <li>Switch back to the browser containing the Azure portal, and refresh your <strong>Alerts page</strong>. You should see a <strong>Sev 4</strong> alert listed in the table (if not, wait up to five minutes and refresh again).</li>
  <li>Select the alert to see its details.</li>
</ol>

<h2 id="visualize-a-metric">Visualize a metric</h2>

<p>As well as defining alerts, you can view metrics for your Azure AI services resource to monitor its utilization.</p>

<ol>
  <li>In the Azure portal, in the page for your Azure AI services resource, select <strong>Metrics</strong> (in the <strong>Monitoring</strong> section).</li>
  <li>If there is no existing chart, select <strong>+ New chart</strong>. Then in the <strong>Metric</strong> list, review the possible metrics you can visualize and select <strong>Total Calls</strong>.</li>
  <li>In the <strong>Aggregation</strong> list, select <strong>Count</strong>.  This will enable you to monitor the total calls to you Azure AI Service resource; which is useful in determining how much the service is being used over a period of time.</li>
  <li>
    <p>To generate some requests to your Azure AI service, you will use <strong>curl</strong> - a command line tool for HTTP requests. In your editor, open <strong>rest-test.cmd</strong> and edit the <strong>curl</strong> command it contains (shown below), replacing <em>&lt;yourEndpoint&gt;</em> and <em>&lt;yourKey&gt;</em> with your endpoint URI and <strong>Key1</strong> key to use the Text Analytics API in your Azure AI services resource.</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock1" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock1" class="mt-0"><code class="hljs nginx"> <span class="hljs-attribute"><span class="hljs-attribute">curl</span></span> -X POST <span class="hljs-string"><span class="hljs-string">"&lt;your-endpoint&gt;/language/:analyze-text?api-version=2023-04-01"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Content-Type: application/json"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Ocp-Apim-Subscription-Key: &lt;your-key&gt;"</span></span> --data-ascii <span class="hljs-string"><span class="hljs-string">"{'analysisInput':{'documents':[{'id':1,'text':'hello'}]}, 'kind': 'LanguageDetection'}"</span></span>
</code></pre>
  </li>
  <li>
    <p>Save your changes and then run the following command:</p>

    <div class="code-header mt-3 mb-0 bg-light d-flex justify-content-between border"><span class="mx-2 text-muted text-capitalize font-weight-light">code</span><button class="m-0 btn btn-code btn-sm btn-light codeBtn rounded-0 border-left text-muted font-weight-light" data-clipboard-target="#codeBlock2" type="button"><i class="fa fa-files-o mr-2" aria-hidden="true"></i>Copy</button></div><pre id="codeBlock2" class="mt-0"><code class="hljs"> ./rest-test.cmd
</code></pre>

    <p>The command returns a JSON document containing information about the language detected in the input data (which should be English).</p>
  </li>
  <li>Re-run the <strong>rest-test</strong> command multiple times to generate some call activity (you can use the <strong>^</strong> key to cycle through previous commands).</li>
  <li>Return to the <strong>Metrics</strong> page in the Azure portal and refresh the <strong>Total Calls</strong> count chart. It may take a few minutes for the calls you made using <em>curl</em> to be reflected in the chart - keep refreshing the chart until it updates to include them.</li>
</ol>

<h2 id="clean-up-resources">Clean up resources</h2>

<p>If you’re not using the Azure resources created in this lab for other training modules, you can delete them to avoid incurring further charges.</p>

<ol>
  <li>
    <p>Open the Azure portal at <code>https://portal.azure.com</code>, and in the top search bar, search for the resources you created in this lab.</p>
  </li>
  <li>
    <p>On the resource page, select <strong>Delete</strong> and follow the instructions to delete the resource. Alternatively, you can delete the entire resource group to clean up all resources at the same time.</p>
  </li>
</ol>

<h2 id="more-information">More information</h2>

<p>One of the options for monitoring Azure AI services is to use <em>diagnostic logging</em>. Once enabled, diagnostic logging captures rich information about your Azure AI services resource usage, and can be a useful monitoring and debugging tool. It can take over an hour after setting up diagnostic logging to generate any information, which is why we haven’t explored it in this exercise; but you can learn more about it in the <a href="https://docs.microsoft.com/azure/ai-services/diagnostic-logging">Azure AI Services documentation</a>.</p>

            </article>
        </main>
    </div>
    <footer class="fixed-bottom d-print-none">
        <nav class="navbar navbar-light bg-light d-flex justify-content-around">
            <span class="navbar-text">
                <i class="fa fa-github" aria-hidden="true"></i>
                <a href="https://github.com/MicrosoftLearning/mslearn-ai-services" target="_blank" class="ml-2">
                    MicrosoftLearning/mslearn-ai-services
                </a>
            </span>
        </nav>
    </footer>
    <script src="./lab03_files/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="./lab03_files/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="./lab03_files/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="./lab03_files/clipboard.min.js"></script>
    <script src="./lab03_files/highlight.min.js"></script>
    <script src="./lab03_files/script.js"></script>



<iframe id="IW50kJ4c" src="./lab03_files/translateSandbox.html" frameborder="0" style="width: 0px; height: 0px;"></iframe></body></html>